# MVP Technical Specification

## 🎯 Goal

To create an MVP web application for restaurants in tourist regions that eliminates the language barrier. The customer orders food via smartphone, and the waiter only delivers and accepts payment.

---

## 📱 UX-Flow (Customer Cabinet)

1. Scan QR → table_id
2. Language selection: 🇻🇳 / 🇬🇧
3. View menu
4. Add dishes + add-ons + comments to dishes
5. Send order
6. Reordering is possible (all within one order)
7. "Pay" button → select payment type:
   - 💵 Cash → call waiter
   - 💳 Card → cashier information
   - 📲 QR → manual payment confirmation
8. Payment after meal → `paid` status
9. "Call waiter" button is always available

---

## 📟 Cabinets

- **Customer**
  - sees all dishes for restaurant
  - add dishes and create order, add additional dishes
  - call waiter, request bill
  - see order status, see dish preparation status

- **Kitchen**:
  - sees all active orders
  - changes status: `in_progress`, `ready`, `requires_attention`
- **Waiter / Cashier**:
  - see tables and orders
  - confirm payment (manual)
  - respond to customer calls
- **Administrator**:
  - menu, dish, add-on management
  - translation support

---

## 🔄 Order Statuses

| Status               | Action                       |
| -------------------- | ---------------------------- |
| `pending`            | Order created                |
| `in_progress`        | Being prepared               |
| `ready`              | Ready                        |
| `delivered`          | Delivered                    |
| `requires_attention` | Customer called waiter       |
| `awaiting_payment`   | Customer clicked "pay"       |
| `paid`               | Paid (waiter or cashier)     |

## 🔄 Dish Statuses

| Status               | Action                       |
| -------------------- | ---------------------------- |
| `awaiting`           | Order created                |
| `preparing`          | Being prepared               |
| `ready`              | Ready                        |
| `dish_delivered`     | Delivered                    |

---

## 📚 Firestore Collections (Database)

| Collection       | Purpose                                                    |
|----------------|-------------------------------------------------------------|
| `restaurants`  | Information about establishments (name, default language, owner) |
| `tables`       | Establishment tables (identifier, number, restaurant)      |
| `menu`         | Menu categories (name, restaurant, sorting)                |
| `dishes`       | Menu items (name, description, price, image, addons)       |
| `orders`       | Active and completed customer orders                       |
| `calls`        | Waiter calls (waiter_call, payment_call)                   |
| `translations` | Texts for multilingual interface (key, value, language)    |
| `users`        | Administrative users: kitchen, waiters, cashiers           |

---

## 🧾 Single Order Structure

```json
{
  "table_id": "A5",
  "lang": "en",
  "is_takeaway": false,
  "order_comment": "No peanuts anywhere, allergic!",
  "dishes": [
    {
      "dish_id": "pho_ga",
      "name": "Phở Gà",
      "base_price": 45000,
      "addons": [
        { "name": "Extra egg", "price": 10000 },
        { "custom": "No onions", "price": 0 }
      ],
      "comment": "Very spicy",
      "takeaway": true,
      "status": "pending"
    },
    {
      "dish_id": "che",
      "name": "Chè",
      "base_price": 25000,
      "addons": [],
      "comment": "",
      "takeaway": false,
      "status": "pending"
    }
  ],
  "status": "pending",
  "total_price": 90000
}
```

---

## 🧠 Special Logic

- `addons` at the dish level (predefined + custom text)
- `comment` for each dish
- `order_comment` — general comment
- `takeaway` — either at the overall order level or individually for dishes
- if at least one dish is `takeaway: false` → the overall takeaway flag is removed
- if `requires_attention` → waiter goes to the customer
- `status` of each dish is stored separately (for partial cooking control)
🛎️ Calls collection:

```json
{
  "table_id": "A5",
  "timestamp": "2025-05-28T12:00:00Z",
  "type": "waiter_call", // or "payment_call"
  "status": "active"
}

Button is always available
Waiter sees active requests in the staff cabinet
Can mark resolved

---

🔐 Roles and Access
- Anonymous users — frontend only (no auth)
- Staff (kitchen, waiters, cashier) — login via email/password
- Each role has separate permissions in Firestore security rules